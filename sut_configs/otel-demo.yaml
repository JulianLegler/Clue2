config:
  namespace: "otel-demo"
  sut_git_repo: "https://github.com/JulianLegler/opentelemetry-demo.git"
  sut_path: "opentelemetry-demo"
  helm_chart_repo: "https://github.com/open-telemetry/opentelemetry-helm-charts"
  helm_chart_path: "opentelemetry-demo/charts/opentelemetry-demo"
  helm_dependencies_from_chart: true # If true, dependencies are fetched from the chart
  values_yaml_name: "values.yaml"
  target_service_name: "frontend" # The k8s service name (used for in-cluster communication)
  application_endpoint_path: "/" # The specific path
  timeout_for_services_ready: 300 # 5 minutes since otel demo can take a while to start
  default_resource_limits:
    cpu: 1000
    memory: 1024
  wait_before_workloads: 180 # 3 minutes in seconds
  wait_after_workloads: 180 # 3 minutes in seconds  

helm_replacements:
  - old_value: "ghcr.io/open-telemetry/demo"
    new_value: "registry:5000/clue/otel-demo"
  - old_value: 'tag: ""'
    new_value: 'tag: "__EXPERIMENT_TAG__"'

limit:
  - service_name: "checkout"
    limit: # You can override defaults here if needed
      cpu: 500 # Using default
      memory: 512 # Using default
  - service_name: "product-catalog"
    limit:
      cpu: 500
      memory: 512
  - service_name: "ad"
    limit:
      cpu: 500
      memory: 512
  - service_name: "frontend-proxy" # Often a key entry point
    limit:
      cpu: 750 # Example: slightly higher for a proxy
      memory: 768
  - service_name: "fraud-detection"
    limit:
      cpu: 500
      memory: 512
  - service_name: "currency"
    limit:
      cpu: 500
      memory: 512
  - service_name: "frontend" # This is different from frontend-proxy
    limit:
      cpu: 750
      memory: 768
  - service_name: "image-provider"
    limit:
      cpu: 500
      memory: 512
  - service_name: "email"
    limit:
      cpu: 500
      memory: 512
  - service_name: "accounting"
    limit:
      cpu: 500
      memory: 512
  - service_name: "cart"
    limit:
      cpu: 500
      memory: 512
  - service_name: "kafka" # Infrastructure component, might need different defaults
    limit:
      cpu: 1000
      memory: 1024
  - service_name: "recommendation"
    limit:
      cpu: 500
      memory: 512
  - service_name: "shipping"
    limit:
      cpu: 500
      memory: 512
  - service_name: "quote"
    limit:
      cpu: 500
      memory: 512
  - service_name: "payment"
    limit:
      cpu: 500
      memory: 512
  - service_name: "flagd-ui" # UI for feature flags, might be less critical for performance
    limit:
      cpu: 250
      memory: 256

workloads:
  - name: "shaped"
    description: "Workload with custom load shape behavior."
    timeout_duration: 120
    workload_settings: {}

variants:
  - name: "baseline"
    description: "Baseline experiment for the otel-demo application"
    target_branch: "main"
    colocated_workload: true
    critical_services:
      [
        "checkout",
        "product-catalog",
        "ad",
        "frontend-proxy",
        "fraud-detection",
        "currency",
        "frontend",
        "image-provider",
        "email",
        "kafka",
        "recommendation",
        "shipping",
        "quote",
        "payment",
      ]
    autoscaling: "cpu"
