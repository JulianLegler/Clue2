name: CLUE Helm Deploy Action
description: Deploys Clue using the Helm chart
inputs:
  kubeconfig:
    description: Base64 encoded kubeconfig
    required: true
  chart-path:
    description: where the helm chart is located
    required: false
    default: clue_helm
  release-name:
    description: Release name
    default: clue
  namespace:
    description: Namespace to deploy into
    default: clue
  values-file:
    description: Optional values file
    required: false
runs:
  using: composite
  steps:
    - name: Setup kubeconfig
      run: |
        echo "${{ inputs.kubeconfig }}" | base64 -d > .kube/kubeconfig
      shell: bash
    - name: Deploy with Helm
      run: |
        CMD="helm upgrade --install ${{ inputs.release-name }} ${{ inputs.chart-path }} --namespace ${{ inputs.namespace }}"
        if [ -n "${{ inputs.values-file }}" ]; then
          CMD="$CMD -f ${{ inputs.values-file }}"
        fi
        $CMD
      shell: bash

                kubeconfig: ${{ secrets.KUBE_CONFIG }}
          chart-path: clue_helm
          release-name: clue